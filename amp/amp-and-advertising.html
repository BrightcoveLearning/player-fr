---
title: "AMP et publicité"
description: "Dans cette rubrique, vous apprendrez à afficher des publicités avec un Brightcove Player qui utilise AMP. Vous apprendrez également à utiliser le consentement côté client avec la configuration Brightcove Player/AMP."
parent: "amp"
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
    <summary>{{ page.description }}</summary>
    <section class="bcls-section">
        <h2 id="section-name">Implémentation de la publicité dans un lecteur AMP</h2>
        <p>La publicité, y compris les pré-rolls, fonctionne dans les lecteurs utilisés dans AMP. Le plugin publicitaire et sa configuration doivent simplement être inclus dans la configuration du lecteur. Si vous devez inclure des valeurs spécifiques à un article dans vos appels au serveur publicitaire, vous pouvez transmettre des données personnalisées à un plug-in de lecteur comme décrit plus loin dans ce document.</p>
        <p>AMP est très strict dans ce qui peut être ajouté à une page AMP valide, comme détaillé dans le <a href="/amp/amp-using-video-cloud-video.html">AMP à l'aide d'une vidéo Video Cloud</a> document. Par exemple, vous NE POUVEZ PAS utiliser la pratique standard d'ajout d'un <code translate="No">id</code> au <code translate="No">amp-brightcove</code> tag puis utilisez un <code translate="No">script</code> block pour configurer, par exemple, le plugin IMA3.</p>
        <p>Pour réitérer, la publicité doit être implémentée dans la configuration du lecteur, soit à l'aide de Studio, soit de l'API Player Management.</p>
        <p>Si vous souhaitez utiliser des URL de configuration d'annonce qui utilisent une macro d'annonce telle que <code translate="No">{pageVariable.<span class="bcls-highlight">adId</span>}</code> , vous devez modifier la configuration du lecteur. Vous pouvez utiliser un paramètre personnalisé comme:</p>
        <pre class="line-numbers">
  <code class="language-html" translate="No">data-param-ad-id="preonlybumper"</code></pre>
        <p>Cela ne rend pas la valeur automatiquement disponible pour la macro d'annonce <code translate="No">{pageVariable.adId}</code>. Pour faire le <code translate="No">ad-id/adId</code> propriété disponible pour l'URL de l'annonce, vous devez utiliser Brightcove Player <a href="/general/player-configuration-guide.html#query_string_to_window">query_string_to_window</a> option de configuration. Cette option contrôle le remplissage des variables d'espace de nom global (fenêtre) à partir des paramètres de chaîne de requête. Pour ajouter tous les paramètres de chaîne de requête à l'espace de noms global, ajoutez ce qui suit à la configuration de votre lecteur:
            <pre class="line-numbers">
<code class="language-bash" translate="No">"query_string_to_window": {
  "target": "queryStringParams"
}</code></pre>
            <p>Noter la <code translate="no">queryStringsParams</code> name est la "variable" dans laquelle les paramètres seront stockés, et vous pouvez changer le nom comme vous le souhaitez.</p>
            <p>Si, pour une raison quelconque, vous préférez attribuer uniquement des paramètres limités à l'espace de noms global, vous pouvez le faire. Par exemple, pour ne faire que le <code class="language-html" translate="No">data-param-<span class="bcls-highlight">ad-id</span>="..."</code> disponible pour le plugin, vous ajoutez ce qui suit à la configuration du lecteur:</p>
            <pre class="line-numbers">
<code class="language-bash" translate="No">"query_string_to_window": {
  "globals": [
    "adId"
  ]
}</code></pre>
            <p>Pour obtenir des instructions spécifiques sur la mise à jour de la configuration d'un lecteur, consultez <a href="https://apis.support.brightcove.com/player-management/references/reference.html#operation/UpdatePlayerConfiguration">Configurations du lecteur - Mettre à jour la configuration d'un lecteur</a> à partir de la référence de l'API Player Management.</p>
    </section>
    <section class="bcls-section">
        <h2 id="section-name">AMP-consentement et publicité</h2>
        <p>Dans AMP, vous pouvez utiliser le consentement côté client, offrant aux utilisateurs un contrôle supplémentaire sur leur expérience en ligne. Si votre page AMP gère le consentement de l'utilisateur avec le consentement AMP et que vous utilisez de la publicité dans le lecteur, vous pouvez alors souhaiter adapter la demande d'annonce du lecteur en fonction de ce consentement. Faites-le en ajoutant un
            <pre><code class="language-javascript">data-block-on-consent = "_ till_responded"</code></pre>
            attribut à l'élément amp-brightcove. Cela retardera le chargement du lecteur jusqu'à ce que l'utilisateur ait accepté ou rejeté son consentement. Sur les pages suivantes où le consentement est connu, le lecteur se chargera normalement sans délai.</p>
        <aside class="bcls-aside bcls-aside--information">Pour plus d'informations sur le consentement de l'utilisateur AMP, voir AMP <a href="https://amp.dev/documentation/examples/user-consent/client_side_user_consent_flow/">Flux de consentement de l'utilisateur côté client</a> document.</aside>
        <h3>Configurations publicitaires</h3>
        <p>Le scénario le plus simple pour mettre en œuvre la publicité et l'AMP consiste à utiliser l'intégration publicitaire IMA standard de Brightcove Player avec Google Ad Manager, qui s'attend à <code translate="no">npa=1</code> à ajouter à la demande d'annonce si le consentement est inconnu ou non donné. Pour ce faire, ajoutez</p>
            <pre><code class="language-javascript">"imaAddNpa": vrai</code></pre>
            <p>aux options du plug-in de support AMP du lecteur, et celui-ci sera automatiquement ajouté à l'URL du serveur publicitaire, comme indiqué ici:</p>
        <figure class="bcls-figure">
            <img class="bcls-image" src="/assets/images/amp/amp-ad-plugin-config.png" alt="plugin configuration">
        </figure>
        <p>Pour les autres modifications apportées à l'URL du serveur publicitaire, l'état de consentement sera défini sur l'iframe du lecteur avec trois paramètres de requête:</p>

        <ul>
            <li><code translate="no">ampInitialConsentState</code>: Si le consentement est accepté, rejeté, inconnu</li>
            <li><code translate="no">ampConsentSharedData</code>: Une chaîne de données JSON du fournisseur de consentement</li>
            <li><code translate="no">ampInitialConsentValue</code>: La chaîne de consentement du fournisseur de consentement</li>
        </ul>

        <p>L'état de consentement est un entier tel que défini dans AMP:</p>

        <ul>
            <li>SUFFISANT: 1</li>
            <li>INSUFFISANT: 2</li>
            <li>INCONNU_NOT_REQUIRED: 3</li>
            <li>INCONNU: 4</li>
        </ul>

        <p>Pour mettre à jour la configuration du lecteur afin de rendre les paramètres de requête du lecteur iFrame disponibles sous forme de simples variables Javascript, ajoutez ce qui suit à la configuration du lecteur dans l'éditeur JSON:</p>
        <pre><code class="language-javascript">"query_string_to_window": {"target": "queryStringParams"}</code></pre>
        <p>Pour obtenir de l'aide, voici une capture d'écran de l'interface utilisateur:
        </p>
        <figure class="bcls-figure">
            <img class="bcls-image" src="/assets/images/amp/amp-ad-json-editor.png" alt="JSON editor">
        </figure>
        <p>Vous pouvez ensuite utiliser les paramètres de requête de consentement dans la demande du serveur publicitaire, soit à l'aide de macros, soit en configurant la severURL comme une fonction.</p>
        <h4>Exemple de macro</h4>
        <pre><code class="language-javascript">"adserverURL": "https://ads.example.com/ad?consent={pageVariable.queryStringParams.ampInitialConsentState}&amp;chaîne de consentement={pageVariable.queryStringParams.ampInitialConsentValue}"</code></pre>
        <h4>Exemple de fonction</h4>
        <p>Configurez le lecteur sans URL de serveur publicitaire en utilisant les éléments suivants:</p>
        <pre><code class="language-javascript">videojs.registerPlugin('setAdUrl', function() { this.ima3.settings.serverUrl = function(callback) { if (window.queryStringParams.ampInitialConsentState === 1) { // Sufficient consent callback('https://ads.example.com/adwithconsent?string={pageVariable.queryStringParams.ampInitialConsentValue}'); } autre { // Use a different ad callback('https://ads.example.com/basicad'); } });</code></pre>


    </section>
</article>