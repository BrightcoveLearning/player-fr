---
title: Messagerie des restrictions de domaine
parent: Troubleshooting
description: In this topic, you will learn how to display appropriate error messages when a video is not allowed to play because of domain restrictions. By default, Brightcove Player does not inform the user that a video is domain restricted.
---

<article class="bcls-article">
  <h1>Messagerie Restrictions de domaine</h1>
  <summary>{{ page.description }}</summary>
  <section class="bcls-section">
    <h2 id="Overview">Présentation</h2>
    <p>Il est possible de restreindre l'endroit où une vidéo peut être visionnée via des restrictions de domaine. le <a href="https://studio.support.brightcove.com/players/configuring-player-content-restrictions.html">Configuration des restrictions de contenu du lecteur</a> Le document vous montre comment utiliser Video Cloud pour appliquer des restrictions de domaine. Le document que vous lisez maintenant vous explique comment implémenter du code pour informer les utilisateurs que le lecteur utilise des restrictions de domaine.</p>
    <p>Par défaut, Brightcove Player n'informe pas l'utilisateur qu'une vidéo qu'il tente de visionner se trouve dans un lecteur limité au domaine. Le joueur affiche simplement un écran noir. Si vous affichez la console, vous verrez ce qui suit.</p>
    <figure class="bcls-figure"><img class="bcls-image" alt="domain restriction console error" src="/assets/images/troubleshooting/domain-restrictions-error-console.png" /></figure>
    <p>Ce n'est pas très utile, mais si vous vérifiez le <strong>Réseau</strong> et cliquez sur un <strong>Nom</strong> correspondant à votre ID vidéo, puis vérifiez le <strong>Aperçu</strong> onglet, vous verrez une erreur plus éclairante.</p>
    <figure class="bcls-figure"><img class="bcls-image" alt="domain message console network tab" src="/assets/images/troubleshooting/domain-restrictions-error-network.png" /></figure>
    <p>Ce document met en œuvre une stratégie pour informer l'utilisateur que la vidéo qu'il essaie de regarder est limitée au domaine.</p>
  </section>
  <section class="bcls-section">
    <h2 id="errorobject">Objet d'erreur du catalogue de lecteurs</h2>
    <p>La clé pour créer un message convivial est la <code translate="No">error</code> objet contenu dans Brightcove Player <code translate="No">catalog</code>. Un exemple d'erreur de restriction de domaine est présenté ci-dessous dans une capture d'écran de la console d'un navigateur. Notez que l'objet contient un <code translate="No">data</code> propriété, qui contient elle-même un tableau. Le tableau contiendra la dernière erreur rencontrée par le catalogue lors du chargement d'une vidéo. Dans l'exemple, vous voyez que l'élément du tableau signale un problème de restriction de domaine.</p>
    <figure class="bcls-figure"><img class="bcls-image" alt="catalog error object" src="/assets/images/troubleshooting/domain-restrictions-catalog-error.png" /></figure>
  </section>
  <section class="bcls-section">
    <h2 id="bccatalogerror">Gérer bc-catalog-error</h2>
    <p>Il est possible que la manipulation des erreurs dans la <code translate="No">ready()</code> section normale du <code translate="No">script</code> bloc puisse causer des problèmes. Par exemple, il peut arriver que l' <code translate="No">bc-catalog-error</code> événement puisse être distribué avant que le joueur soit prêt, et si vous écoutez l'erreur dans la <code translate="No">ready()</code> section, vous ne serez pas en mesure de gérer l'erreur. Vous pouvez constater qu'il n'y a pas de problème dans votre code, mais le problème peut dépendre du navigateur, alors soyez prudent. Pour cette raison, le code de gestion des erreurs dans ce document utilisera le <code translate="No">one()</code> méthode de gestion des événements pour écouter le <code translate="No">bc-catalog-error</code> dans un bloc de code séparé plutôt que dans le <code translate="No">ready()</code> section.</p>
  </section>
  <section class="bcls-section">
    <h2 id="htmlmessage">Message en HTML</h2>
    <p>Une fois que vous avez compris la structure de l'erreur qui est produite et où elle se trouve, vous pouvez utiliser JavaScript pour afficher une erreur descriptive pour l'utilisateur. Les étapes de base de la mise en œuvre sont:</p>
    <ul>
      <li>Créez un élément cible dans lequel afficher le message.</li>
      <li>Assurez-vous que le joueur est prêt à agir.</li>
      <li>Vérifiez si une erreur s'est produite.</li>
      <li>Si oui, vérifiez si l'erreur est un problème de restriction de domaine.</li>
      <li>Si oui, affichez le message à l'utilisateur.</li>
    </ul>
    <p>Le code suivant implémente ces étapes.</p>
    <ul>
      <li>Ligne 8 : Insérez un élément HTML, dans ce cas un paragraphe, dans lequel injecter du texte; donner à l'élément un <code translate="No">id</code> à des fins de ciblage.</li>
      <li>Ligne 13 : Utilisez la <code translate="No">one()</code> méthode pour ajouter un écouteur d'événement pour l' <code translate="No">bc-catalog-error</code> événement une seule fois.</li>
      <li>Ligne 16 : Utilisez un <code translate="No">if</code> pour être sûr qu'une erreur s'est produite.</li>
      <li>Ligne 17: Attribuez à une variable les informations d'erreur spécifiques de l'objet d'erreur du catalogue Brightcove Player.</li>
      <li>Ligne 18 : Utilisez un <code translate="No">if</code> pour être sûr que les informations d'erreur spécifiques existent ET que le type d'erreur provient d'une restriction de domaine.</li>
      <li>Ligne 19: Injectez un message texte approprié dans l'élément HTML créé à la ligne 12.</li>
    </ul>
    <pre class="line-numbers">
<code class="language-html" translate="No">  &lt;video-js id="myPlayerID"
    data-video-id="3495887198001"
    data-account="1507807800001"
    data-player="4c8eb732-ba76-485c-a906-407365721633"
    data-embed="default"
    class="video-js" controls&gt;&lt;/video-js&gt;

    <span class="bcls-highlight">&lt;p id="textTarget"&gt;&lt;/p&gt;</span>

  &lt;script src="https://players.brightcove.net/1507807800001/4c8eb732-ba76-485c-a906-407365721633_default/index.min.js"&gt;&lt;/script&gt;

  &lt;script type="text/javascript"&gt;
    videojs.getPlayer('myPlayerID').<span class="bcls-highlight">one('bc-catalog-error', function(){</span>
      var myPlayer = this,
        specificError;
      <span class="bcls-highlight">if (myPlayer.catalog.error !== undefined) {
        specificError = myPlayer.catalog.error.data[0];
        if (specificError !== undefined &amp; specificError.error_subcode == "DOMAIN") {
          document.getElementById("textTarget").innerHTML = "The video you are trying to watch cannot be viewed as it is domain restricted.";
        };
      };</span>
    });

    videojs.getPlayer('myPlayerID').ready(function() {
      var myPlayer = this;
      console.log('in ready');
    });
  &lt;/script&gt;</code></pre>
    <p>La capture d'écran suivante montre le message affiché sous le lecteur.</p>
    <figure class="bcls-figure"><img class="bcls-image" alt="error below player" src="/assets/images/troubleshooting/domain-restrictions-html-message.png" /></figure>
  </section>
  <section class="bcls-section">
    <h2 id="errorplugin">Message via le plugin d'erreurs</h2>
    <p>Vous souhaiterez peut-être afficher le message dans le lecteur si la vidéo est limitée au domaine. Vous pouvez le faire en utilisant le plugin d'erreurs. Le plugin d'erreurs est automatiquement chargé dans le lecteur, vous n'avez donc pas besoin d'effectuer explicitement cette opération. Pour plus de détails sur le plugin d'erreurs au-delà de ce qui sera mentionné ici, consultez le <a href="/plugins/display-error-messages-plugin.html">Afficher le plugin des messages d'erreur</a> document.</p>
    <ul>
      <li>Ligne 43 : Utilisez la <code translate="No">one()</code> méthode ajouter un écouteur d'événement pour l' <code translate="No">bc-catalog-error</code> événement une seule fois.</li>
      <li>Lignes 46-53: Appeler le joueur <code translate="No">error()</code> méthode, en passant en argument JSON qui définit le <code translate="No">errors</code> informations à afficher. Notez que le choix de <code translate="No">-3</code> car le code d'erreur est arbitraire et la seule indication est de ne pas utiliser de code d'erreur standard (actuellement 1-5).</li>
      <li>Ligne 57 : Appeler le <code translate="No">error()</code> méthode pour afficher les informations d'erreur personnalisées. La logique utilisée pour déterminer quand l'erreur de restriction de domaine s'est produite est la même que ci-dessus. L'objet passé en argument définit le message d'erreur à afficher.</li>
    </ul>
    <pre class="line-numbers" data-start="42">
<code class="language-html" translate="No">  &lt;script type="text/javascript"&gt;
    videojs.getPlayer('myPlayerID').<span class="bcls-highlight">one('bc-catalog-error', function(){</span>
      var myPlayer = this,
        specificError;
      <span class="bcls-highlight">myPlayer.errors({
        'errors': {
          '-3': {
            'headline': 'The video you are trying to watch cannot be viewed because of domain restrictions.',
            'type': 'DOMAIN'
          }
        }
      });</span>
      if (typeof(myPlayer.catalog.error) !== 'undefined') {
        specificError = myPlayer.catalog.error.data[0];
        if (specificError !== 'undefined' &amp; specificError.error_subcode == "DOMAIN") {
          <span class="bcls-highlight">myPlayer.error({code:'-3'});</span>
        };
      };
    });

    videojs.getPlayer('myPlayerID').ready(function() {
      var myPlayer = this;
    });
  &lt;/script&gt;</code></pre>
    <p>La capture d'écran suivante montre l'affichage de l'erreur définie par le plugin d'erreur.</p>
    <figure class="bcls-figure"><img class="bcls-image" alt="defined error" src="/assets/images/troubleshooting/domain-restrictions-errors-plugin.png" /></figure>
  </section>
  <section id="generalerror" class="bcls-section">
    <h2>Affichage des erreurs générales</h2>
    <p>Les deux sections ci-dessus traitent spécifiquement de l'affichage de l'erreur générée lorsqu'une vidéo géo-restreinte est visualisée à partir d'un paramètre régional restreint. Certaines erreurs ne fournissent pas le niveau de détail de la restriction de domaine. Un exemple d'objet d'erreur de ce type est présenté ici. Notez que le <strong>Les données</strong> Le champ est vide, alors qu'avec l'erreur de restriction de domaine, il contenait des informations d'erreur clés.</p>
    <figure class="bcls-figure"><img class="bcls-image" alt="general error object" src="/assets/images/troubleshooting/domain-restrictions-general-error.png" /></figure>
    <p>Le code suivant montre comment afficher les informations de <code translate="No">catalog.error</code> peu importe le niveau de détail. À un niveau élevé, le code effectue les opérations suivantes:</p>
    <ul>
      <li>Vérifie si une erreur de catalogue s'est produite.</li>
      <li>Vérifie si dans l'objet d'erreur le <code translate="No">data</code> Le champ contient des informations d'erreur spécifiques. Si ce n'est PAS le cas, le message d'erreur général est injecté dans le HTML.</li>
      <li>S'il y a des informations d'erreur spécifiques ET qu'il s'agit d'une restriction de domaine, un message approprié est injecté dans le HTML.</li>
      <li>S'il existe des informations d'erreur spécifiques et qu'elles ne sont pas liées à la restriction de domaine, le message d'erreur spécifique est injecté dans le HTML.</li>
    </ul>
    <pre class="line-numbers" data-start="69">
<code class="language-html" translate="No">  &lt;script type="text/javascript"&gt;
    videojs.getPlayer('myPlayerID').one('bc-catalog-error', function(){
      var myPlayer = this,
        specificError;
      if (myPlayer.catalog.error != undefined) {
        specificError = myPlayer.catalog.error.data[0];
        if (specificError == undefined) {
          document.getElementById("textTarget").innerHTML = "The following error has occurred: &lt;strong&gt;" + myPlayer.catalog.error.message + "&lt;/strong&gt;";
        } else if (specificError.error_subcode == "DOMAIN") {
          document.getElementById("textTarget").innerHTML = "The video you are trying to watch cannot be viewed because of domain restrictions.";
        } else {
          document.getElementById("textTarget").innerHTML = "The following error has occurred: " + specificError.message;
        };
      };
    });

    videojs.getPlayer('myPlayerID').ready(function() {
      var myPlayer = this;
    });
  &lt;/script&gt;</code></pre>
    <p>La capture d'écran suivante montre le message d'erreur général affiché en HTML. Bien sûr, vous pouvez également utiliser le plugin d'erreurs pour afficher le message, comme indiqué dans la section précédente de ce document.</p>
    <figure class="bcls-figure"><img class="bcls-image" alt="general error message display below player" src="/assets/images/troubleshooting/domain-restrictions-general-message.png" /></figure>
  </section>
</article>